{% comment %}
THIS WAS GENERATED BY AN LLM, SO TAKE EVERYTHING WITH A PINCH OF SALT.
Collect all pages with `sidebar_link: true`
{% endcomment %}
{% assign nav_pages = site.pages | where: "sidebar_link", true %}

{% comment %}
Collect all category pages (layout == "category")
{% endcomment %}
{% assign category_pages = site.pages | where: "layout", "category" %}

{% comment %}
Merge nav pages + category pages into a single array
{% endcomment %}
{% assign merged = nav_pages | concat: category_pages %}

{% comment %}
Split merged into two arrays:
 - unordered: missing sidebar_sort_order
 - ordered: has sidebar_sort_order
{% endcomment %}
{% assign unordered = merged | where_exp: "item", "item.sidebar_sort_order == nil" %}
{% assign ordered   = merged | where_exp: "item", "item.sidebar_sort_order != nil" %}

{% comment %}
Sort unordered alphabetically by title
{% endcomment %}
{% assign unordered_sorted = unordered | sort: "title" %}

{% comment %}
Sort ordered numerically by sidebar_sort_order
Liquidâ€™s sort treats numbers as strings, but will still sort ascending if all are numbers.
{% endcomment %}
{% assign ordered_sorted = ordered | sort: "sidebar_sort_order" %}

{% comment %}
Concatenate: unordered first, then ordered
{% endcomment %}
{% assign final_list = unordered_sorted | concat: ordered_sorted %}

{% comment %}
Render
{% endcomment %}
{% for node in final_list %}
  {% if node.title %}
    {% if node.layout == "category" %}
      <a class="category-link{% if page.url == node.url %} active{% endif %}"
         href="{{ node.url | relative_url }}">{{ node.title }}</a>
    {% else %}
      <a class="page-link{% if page.url == node.url %} active{% endif %}"
         href="{{ node.url | relative_url }}">{{ node.title }}</a>
    {% endif %}
  {% endif %}
{% endfor %}